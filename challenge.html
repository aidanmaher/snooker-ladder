<!DOCTYPE html>
<html>
<head>
  <title>Issue a Challenge</title>
  <link rel="stylesheet" href="style.css"> <!-- Same CSS as match_submit.html -->
</head>
<body>
  <div class="container">
    <h2 class="page-title">üèÜ Issue a Challenge</h2>

    <form id="challengeForm" class="form-section">
      <div class="form-group">
        <label for="challenger">Your Name:</label>
        <select id="challenger" name="challenger" class="form-control"></select>
      </div>

      <div class="form-group">
        <label for="opponent">Opponent:</label>
        <select id="opponent" name="opponent" class="form-control"></select>
        <div id="activeWarning" class="form-warning hidden">
          ‚ö†Ô∏è This player is already under challenge, are you sure you wish to proceed?
        </div>
      </div>

      <div class="form-group">
        <label for="format">Match Format:</label>
        <select id="format" name="format" class="form-control">
          <option value="Best of 1">Best of 1 frame</option>
          <option value="Best of 3">Best of 3 frames</option>
        </select>
      </div>

      <div class="form-group">
        <label for="notes">Notes (optional):</label>
        <textarea id="notes" name="notes" rows="3" class="form-control"></textarea>
      </div>

      <button type="submit" class="btn-submit">Submit Challenge</button>
    </form>

    <div id="confirmation" class="confirmation-text"></div>
  </div>

  <script>
    // Dummy data ‚Äî this will be dynamic in production
    const players = ["Alice", "Bob", "Charlie", "David"];
    const dropdowns = ["challenger", "opponent"];
    dropdowns.forEach(id => {
      const select = document.getElementById(id);
      players.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p; opt.textContent = p;
        select.appendChild(opt);
      });
    });

    document.getElementById("challengeForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const challenger = document.getElementById("challenger").value;
      const opponent = document.getElementById("opponent").value;
      const format = document.getElementById("format").value;
      const notes = document.getElementById("notes").value;

      // Challenge status check
      fetch(`https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec?action=checkChallenge&opponent=${opponent}`)
        .then(res => res.json())
        .then(data => {
          if (data.isChallenged) {
            document.getElementById("activeWarning").classList.remove("hidden");
            // Optional: prompt user to confirm
          } else {
            document.getElementById("activeWarning").classList.add("hidden");
            submitChallenge();
          }
        });

      function submitChallenge() {
        fetch(`https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ challenger, opponent, format, notes })
        })
        .then(res => res.text())
        .then(msg => {
          document.getElementById("confirmation").innerHTML = `‚úÖ Challenge submitted to ${opponent}!`;
        });
      }
    });
  </script>
</body>
</html>
