<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Snooker Match Submission</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js"></script>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 40px auto; }
    label { display: block; margin-top: 15px; }
    select, input { width: 100%; padding: 8px; margin-top: 5px; }
    button { margin-top: 20px; padding: 10px 20px; }
  </style>
</head>
<body>

  <h1>ðŸŽ± Record a Match ðŸŽ±</h1>

  <form id="matchForm">
    <label for="playerA">Player A:</label>
    <select id="playerA"><option>Loadingâ€¦</option></select>

    <label for="playerB">Player B:</label>
    <select id="playerB"><option>Loadingâ€¦</option></select>

    <label for="matchDate">Match Date:</label>
    <input type="date" id="matchDate" required>

    <label for="winner">Winner:</label>
    <select id="winner"><option>Loadingâ€¦</option></select>

    <label for="score">Winning Score:</label>
    <input type="text" id="score" placeholder="e.g. 3-1">

    <label for="pointsA">Total Points (Player A):</label>
    <input type="number" id="pointsA">

    <label for="pointsB">Total Points (Player B):</label>
    <input type="number" id="pointsB">

    <label for="highBreakA">High Break (Player A):</label>
    <input type="number" id="highBreakA">

    <label for="highBreakB">High Break (Player B):</label>
    <input type="number" id="highBreakB">

    <button type="submit">Submit Match</button>
  </form>

<script>
  const SHEET_ID = '1zaW4RrgVFANKEh2VWVC8rRFUA108X4mxAFBUh0CkHZE';
  const SHEET_NAME = 'Players';

  // Build the gviz URL (this returns a JS function call wrapping JSON)
  const GVIZ_URL = 
    `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?` +
    `sheet=${encodeURIComponent(SHEET_NAME)}&headers=1`;

  // grabs your <select> elements
  const selA = document.getElementById('playerA');
  const selB = document.getElementById('playerB');
  const selW = document.getElementById('winner');

  // on page load, fetch & populate
  window.addEventListener('DOMContentLoaded', () => {
    fetch(GVIZ_URL)
      .then(r => r.text())
      .then(txt => {
        // strip the Google wrapper: "google.visualization.Query.setResponse(...);"
        const json = JSON.parse(
          txt.match(/setResponse\(([\s\S]+)\)/)[1]
        );

        // the table schema
        const cols = json.table.cols.map(c => c.label);
        const rows = json.table.rows.map(r => r.c.map(cell => (cell||{}).v));

        // find the "Name" column index
        const nameCol = cols.indexOf('Name');
        if (nameCol < 0) throw new Error('No "Name" column found');

        // clear loading placeholder
        [selA, selB, selW].forEach(sel => {
          sel.innerHTML = '<option disabled selected>Selectâ€¦</option>';
        });

        // inject each player into all three dropdowns
        rows.forEach(row => {
          const name = row[nameCol];
          if (!name) return;
          [selA, selB, selW].forEach(sel => {
            const opt = document.createElement('option');
            opt.value = name;
            opt.textContent = name;
            sel.appendChild(opt);
          });
        });
      })
      .catch(err => {
        console.error('Error loading Players:', err);
        [selA, selB, selW].forEach(sel => {
          sel.innerHTML = '<option>Error loading names</option>';
        });
      });
  });
</script>

</body>
</html>
